!function(t){function e(a){if(r[a])return r[a].exports;var n=r[a]={i:a,l:!1,exports:{}};return t[a].call(n.exports,n,n.exports,e),n.l=!0,n.exports}var r={};e.m=t,e.c=r,e.d=function(t,r,a){e.o(t,r)||Object.defineProperty(t,r,{configurable:!1,enumerable:!0,get:a})},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,"a",r),r},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}([function(t,e,r){t.exports=r(1)},function(t,e,r){var a=r(2);t.exports=window.tar=new a},function(t,e,r){function a(){var t=new n,e=new s(t),r=new o(t,e),a=new i(t);this.init=function(n){if(location.href.match(/[?&]inShowState=([^&]*)/)&&n.tar_hot_map)return t.tar_hot_map=n.tar_hot_map,void t.loadSword(!0);t.init(n);var o=!0;(o=t.isWechatEnv()?r.init():!n.tar_auth_onlywx&&n.tar_scope?r.init():a.init())&&e.init()},this.ready=function(e){t.cb_ready=e},this.shapeShareAppMessage=function(t){return r.shapeShare(t,"friend")},this.shapeShareTimeline=function(t){return r.shapeShare(t,"timeline")},this.shapeShareQQ=function(t){return r.shapeShare(t,"qq")},this.shapeShareQZone=function(t){return r.shapeShare(t,"qzone")},this.hitTag=function(t,r){e.hitTag(t,r)},this.shapeShareLink=function(t,e){var r=new Object;return r.link=t,"ShareAppMessage"==e?r=this.shapeShareAppMessage(r):"ShareTimeline"==e&&(r=this.shapeShareTimeline(r)),r.link},this.shapeShareSuccess=function(t){"ShareAppMessage"==t?r.shapeShareSuccess("friend"):"ShareTimeline"==t&&r.shapeShareSuccess("timeline")}}t.exports=a;var n=r(3),o=r(4),i=r(5),s=r(6)},function(t,e){function r(){var t=Math.round(7*Math.random()+2);this.protocol="https:",this.tar_slb_domain=this.protocol+"//slb"+t+".tarsocial.com";var e=this.protocol+"//api.h5mo.com";this.tar_open_domain=e,this.encrypturl=e+"/v1/wxopen/encrypt",this.shorturl=e+"/v1/wxopen/shorturl",this.hitTagurl=this.tar_slb_domain+"/in/act",this.sendStayurl=this.tar_slb_domain+"/in/wxt",this.posturlold=this.tar_slb_domain+"/in/wxs",this.posturlnew=this.tar_slb_domain+"/in/wxc",this.rc4Key="tar"}t.exports=r,r.prototype.init=function(t){this.tar_init_time=new Date,this.tar_init=!0;Date.parse(this.tar_init_time);this.tar_key="monitor",this.tar_event=this.trim(t.tar_tid),this.tar_debug=!(!t.tar_debug||1!=t.tar_debug)&&t.tar_debug,this.tar_scope=t.tar_scope,this.tar_appid=t.tar_appid,this.tar_userinfo=t.tar_userinfo,this.tar_token=this.trim(t.tar_token),this.scopekey="tar-scope-"+this.tar_event,this.userinfokey="tar-userinfo-"+this.tar_event,this.statekey="tar-state-"+this.tar_event,this.uuidkey="tar-uuid-"+this.tar_event,this.tar_hot_map=t.tar_hot_map,this.tar_init_flag=!1,this.hitData=[],this.tar_differ_time=t.tar_differ_time||2e4,this.cb_ready=null,this.tar_type=t.tar_type||0,this.tar_visit_time_last=parseInt(window.localStorage.getItem("tar_visit_time"))||0,this.tar_wxArticle_data={},window.localStorage.setItem("tar_visit_time",Date.parse(new Date));var e=/micromessenger/i.test(navigator.userAgent);this.oauthurl=(t.tar_auth_domain||"http://"+this.tar_appid+".auth.shijisuxie.top")+"/v1/wxopen/auth",this.tar_wechat_env=e,this.posturl=this.tar_slb_domain+"/in/wxc";var r=window.localStorage.getItem(this.uuidkey);void 0===r||null==r||""==r?(r=this.getCookie(this.uuidkey),this.tar_oid=void 0===r||null==r||""==r?this.guid():r,/QQ/i.test(navigator.userAgent)&&(this.tar_oid="qq:"+this.tar_oid),window.localStorage.setItem(this.uuidkey,this.tar_oid)):this.tar_oid=r;var a=this.getUrlArgMap();this.tar_foid=a.tar_foid,this.tar_from=a.from,this.tar_channel=a.tar_channel||"";var n="tar-fuuid-"+this.tar_event,o="tar-channel-"+this.tar_event;if(this.tar_foid){var i=this.tar_foid.substring(0,2),s=window.localStorage.getItem(o)||"";s&&"C-"==s.substring(0,2)||"_D"==i||"C-"==i?(this.posturl=this.posturlnew,s&&(this.tar_channel=s),"C-"==i&&(window.localStorage.setItem(o,this.tar_foid),this.tar_channel=this.tar_foid)):this.posturl=this.posturlold,this.tar_foid!=this.tar_oid&&window.localStorage.setItem(n,this.tar_foid)}else this.tar_foid=window.localStorage.getItem(n),this.tar_foid||(this.tar_foid="root");if(this.tar_from){var c="tar-from-"+this.tar_event;window.localStorage.setItem(c,this.tar_from)}else this.tar_wechat_env?this.tar_from="wechat":this.tar_from="other";var u=this.removeUrlParam(location.href,"tar_foid");if(u=this.removeUrlParam(u,"from"),u=this.removeUrlParam(u,"isappinstalled"),u=this.removeUrlParam(u,"timestamp"),u=this.removeUrlParam(u,"userinfo"),this.tar_url=u,this.tar_width=document.documentElement.clientWidth,this.tar_height=document.documentElement.clientHeight,this.setCookieAdv(this.uuidkey,this.tar_oid,365),this.tar_type){document.querySelector("body").style.height="auto";var l=document.querySelector("body").offsetHeight;this.tar_wxArticle_data.height=l,this.tar_wxArticle_data.clientH=document.documentElement.clientHeight,this.tar_wxArticle_data.scrollH={},this.wxArticle()}},r.prototype.wxArticle=function(){var t=this,e=document.body.scrollTop;t.tar_wxArticle_data.scrollH[e]&&void 0!=t.tar_wxArticle_data.scrollH[e]||(t.tar_wxArticle_data.scrollH[e]=0),t.tar_wxArticle_data.scrollH[e]++,setTimeout(function(){t.wxArticle()},1e3)},r.prototype.isWechatEnv=function(){return this.tar_wechat_env},r.prototype.postMessageToMiniprogram=function(t){"undefined"!=typeof wx&&wx.miniProgram&&wx.miniProgram.getEnv(function(e){e.miniprogram&&wx.miniProgram.postMessage({data:t})})},r.prototype.resetOpenid=function(t){this.tar_oid=t,window.localStorage.setItem(this.uuidkey,t),this.setCookieAdv(this.uuidkey,t,365)},r.prototype.loadSword=function(t){if(this.tar_hot_map){var e=document.getElementsByTagName("head")[0],r=document.createElement("script"),a=this;r.type="text/javascript",r.async=!0,r.onload=r.onreadystatechange=function(){if(!this.readyState||"loaded"===this.readyState||"complete"===this.readyState){r.onload=r.onreadystatechange=null;var e=window["sword-web"];if(t)return void e.crossMessage();e&&"function"==typeof e.init&&(console.log(e,"sword-init"),e.init({eventid:a.tar_event,openid:a.tar_oid,debug:a.tar_debug}))}},r.src=a.protocol+"//cdn.tarsocial.com/sword-web/sword-web-min.js?v=38900",e.appendChild(r)}},r.prototype.debug=function(t,e){if(this.tar_debug)if(/wxdebugger/i.test(navigator.userAgent)||!this.tar_wechat_env)console.log(t),console.log(e);else{var r=t+"\n";r+="object"==typeof e?JSON.stringify(e):e,alert(r)}},r.prototype.setCookieAdv=function(t,e,r){var a=new Date;a.setDate(a.getDate()+r),document.cookie=t+"="+escape(e)+(null==r?"":";expires="+a.toGMTString())},r.prototype.getCookie=function(t){var e,r=null,a=document.cookie+";",n=t+"=",o=a.indexOf(n);return-1!=o&&(o+=n.length,e=a.indexOf(";",o),r=unescape(a.substring(o,e))),r},r.prototype.guid=function(){function t(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},r.prototype.getUrlArgMap=function(t){var e=new Object,r=location.search.substring(1);if(t){var a=t.split("?");2==a.length&&(r=a[1])}for(var n=r.split("&"),o=0;o<n.length;o++){var i=n[o].indexOf("=");if(-1!=i){var s=n[o].substring(0,i),c=n[o].substring(i+1);e[s]=unescape(c)}}return e},r.prototype.removeUrlParam=function(t,e){var r="",a="",n=t.indexOf("#");if(-1!=n&&(a=t.substr(n)),-1==t.indexOf("?"))return t+a;r=t.substr(t.indexOf("?")+1);var o="",i="",s="";if(-1!=r.indexOf("&")){o=r.split("&");for(var c in o)if(o.hasOwnProperty(c)){var u=o[c].indexOf("="),l=o[c].substring(0,u),_=o[c].substring(u+1,o[c].length);l!=e&&(i=i+l+"="+_+"&")}s=t.substr(0,t.indexOf("?"))+"?"+i.substr(0,i.length-1)}else o=r.split("="),s=o[0]==e?t.substr(0,t.indexOf("?")):t;return s+a},r.prototype.Ajax=function(){function t(t,a){function n(){}var o=!1!==a.async,i=a.method||"GET",s=a.data||null,c=a.success||n,u=a.failure||n;i=i.toUpperCase(),"GET"==i&&s&&(s=r(s),t+=(-1==t.indexOf("?")?"?":"&")+s,s=null),t+=(-1==t.indexOf("?")?"?":"&")+"t="+Date.parse(new Date)/1e3;var l=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");l.onreadystatechange=function(){e(l,c,u)};var _=0;-1!=t.indexOf("wxf")&&(_=300),setTimeout(function(){return l.open(i,t,o),"POST"==i&&(s=r(s),l.setRequestHeader("Content-type","application/x-www-form-urlencoded;")),l.send(s),l},_)}function e(t,e,r){if(4==t.readyState){var a=t.status;a>=200&&a<300?e(t):r(t)}}function r(t){if("string"==typeof t||null==t)return t;if("object"==typeof t){var e="";for(var r in t)e="&"+r+"="+t[r]+e;return e.substr(1)}return t.toString()}return{request:t}}(),r.prototype.urlencode=function(t){return t=(t+"").toString(),encodeURIComponent(t).replace(/!/g,"%21").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A").replace(/%2B/g,"+").replace(/%252B/g,"+")},r.prototype.str_replace=function(t,e,r,a){var n=0,o=0,i="",s="",c=0,u=0,l=[].concat(t),_=[].concat(e),d=r,h=_ instanceof Array,m=d instanceof Array;for(d=[].concat(d),a&&(this.window[a]=0),n=0,c=d.length;n<c;n++)if(""!==d[n])for(o=0,u=l.length;o<u;o++)i=d[n]+"",s=h?void 0!==_[o]?_[o]:"":_[0],d[n]=i.split(l[o]).join(s),a&&d[n]!==i&&(this.window[a]+=(i.length-d[n].length)/l[o].length);return m?d:d[0]},r.prototype.utf8to16=function(t){var e,r,a,n,o,i;for(e="",a=t.length,r=0;r<a;)switch((n=t.charCodeAt(r++))>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:e+=t.charAt(r-1);break;case 12:case 13:o=t.charCodeAt(r++),e+=String.fromCharCode((31&n)<<6|63&o);break;case 14:o=t.charCodeAt(r++),i=t.charCodeAt(r++),e+=String.fromCharCode((15&n)<<12|(63&o)<<6|(63&i)<<0)}return e},r.prototype.base64decode=function(t){var e,r,a,n,o,i,s,c=new Array(-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1);for(i=t.length,o=0,s="";o<i;){do{e=c[255&t.charCodeAt(o++)]}while(o<i&&-1==e);if(-1==e)break;do{r=c[255&t.charCodeAt(o++)]}while(o<i&&-1==r);if(-1==r)break;s+=String.fromCharCode(e<<2|(48&r)>>4);do{if(61==(a=255&t.charCodeAt(o++)))return s;a=c[a]}while(o<i&&-1==a);if(-1==a)break;s+=String.fromCharCode((15&r)<<4|(60&a)>>2);do{if(61==(n=255&t.charCodeAt(o++)))return s;n=c[n]}while(o<i&&-1==n);if(-1==n)break;s+=String.fromCharCode((3&a)<<6|n)}return s},r.prototype.rc4=function(t,e){for(var r,a=[],n=0,o="",i=0;i<256;i++)a[i]=i;for(i=0;i<256;i++)n=(n+a[i]+t.charCodeAt(i%t.length))%256,r=a[i],a[i]=a[n],a[n]=r;i=0,n=0;for(var s=0;s<e.length;s++)i=(i+1)%256,n=(n+a[i])%256,r=a[i],a[i]=a[n],a[n]=r,o+=String.fromCharCode(e.charCodeAt(s)^a[(a[i]+a[n])%256]);return o},r.prototype.trim=function(t){return isNaN(t)&&t?t.replace(/(^\s*)|(\s*$)/g,""):t},r.prototype.hex_md5=function(t){function e(t,e){var r=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(r>>16)<<16|65535&r}function r(t,e){return t<<e|t>>>32-e}function a(t,a,n,o,i,s){return e(r(e(e(a,t),e(o,s)),i),n)}function n(t,e,r,n,o,i,s){return a(e&r|~e&n,t,e,o,i,s)}function o(t,e,r,n,o,i,s){return a(e&n|r&~n,t,e,o,i,s)}function i(t,e,r,n,o,i,s){return a(e^r^n,t,e,o,i,s)}function s(t,e,r,n,o,i,s){return a(r^(e|~n),t,e,o,i,s)}var c=0,u=8;return function(t){for(var e=c?"0123456789ABCDEF":"0123456789abcdef",r="",a=0;a<4*t.length;a++)r+=e.charAt(t[a>>2]>>a%4*8+4&15)+e.charAt(t[a>>2]>>a%4*8&15);return r}(function(t,r){t[r>>5]|=128<<r%32,t[14+(r+64>>>9<<4)]=r;for(var a=1732584193,c=-271733879,u=-1732584194,l=271733878,_=0;_<t.length;_+=16){var d=a,h=c,m=u,f=l;a=n(a,c,u,l,t[_+0],7,-680876936),l=n(l,a,c,u,t[_+1],12,-389564586),u=n(u,l,a,c,t[_+2],17,606105819),c=n(c,u,l,a,t[_+3],22,-1044525330),a=n(a,c,u,l,t[_+4],7,-176418897),l=n(l,a,c,u,t[_+5],12,1200080426),u=n(u,l,a,c,t[_+6],17,-1473231341),c=n(c,u,l,a,t[_+7],22,-45705983),a=n(a,c,u,l,t[_+8],7,1770035416),l=n(l,a,c,u,t[_+9],12,-1958414417),u=n(u,l,a,c,t[_+10],17,-42063),c=n(c,u,l,a,t[_+11],22,-1990404162),a=n(a,c,u,l,t[_+12],7,1804603682),l=n(l,a,c,u,t[_+13],12,-40341101),u=n(u,l,a,c,t[_+14],17,-1502002290),c=n(c,u,l,a,t[_+15],22,1236535329),a=o(a,c,u,l,t[_+1],5,-165796510),l=o(l,a,c,u,t[_+6],9,-1069501632),u=o(u,l,a,c,t[_+11],14,643717713),c=o(c,u,l,a,t[_+0],20,-373897302),a=o(a,c,u,l,t[_+5],5,-701558691),l=o(l,a,c,u,t[_+10],9,38016083),u=o(u,l,a,c,t[_+15],14,-660478335),c=o(c,u,l,a,t[_+4],20,-405537848),a=o(a,c,u,l,t[_+9],5,568446438),l=o(l,a,c,u,t[_+14],9,-1019803690),u=o(u,l,a,c,t[_+3],14,-187363961),c=o(c,u,l,a,t[_+8],20,1163531501),a=o(a,c,u,l,t[_+13],5,-1444681467),l=o(l,a,c,u,t[_+2],9,-51403784),u=o(u,l,a,c,t[_+7],14,1735328473),c=o(c,u,l,a,t[_+12],20,-1926607734),a=i(a,c,u,l,t[_+5],4,-378558),l=i(l,a,c,u,t[_+8],11,-2022574463),u=i(u,l,a,c,t[_+11],16,1839030562),c=i(c,u,l,a,t[_+14],23,-35309556),a=i(a,c,u,l,t[_+1],4,-1530992060),l=i(l,a,c,u,t[_+4],11,1272893353),u=i(u,l,a,c,t[_+7],16,-155497632),c=i(c,u,l,a,t[_+10],23,-1094730640),a=i(a,c,u,l,t[_+13],4,681279174),l=i(l,a,c,u,t[_+0],11,-358537222),u=i(u,l,a,c,t[_+3],16,-722521979),c=i(c,u,l,a,t[_+6],23,76029189),a=i(a,c,u,l,t[_+9],4,-640364487),l=i(l,a,c,u,t[_+12],11,-421815835),u=i(u,l,a,c,t[_+15],16,530742520),c=i(c,u,l,a,t[_+2],23,-995338651),a=s(a,c,u,l,t[_+0],6,-198630844),l=s(l,a,c,u,t[_+7],10,1126891415),u=s(u,l,a,c,t[_+14],15,-1416354905),c=s(c,u,l,a,t[_+5],21,-57434055),a=s(a,c,u,l,t[_+12],6,1700485571),l=s(l,a,c,u,t[_+3],10,-1894986606),u=s(u,l,a,c,t[_+10],15,-1051523),c=s(c,u,l,a,t[_+1],21,-2054922799),a=s(a,c,u,l,t[_+8],6,1873313359),l=s(l,a,c,u,t[_+15],10,-30611744),u=s(u,l,a,c,t[_+6],15,-1560198380),c=s(c,u,l,a,t[_+13],21,1309151649),a=s(a,c,u,l,t[_+4],6,-145523070),l=s(l,a,c,u,t[_+11],10,-1120210379),u=s(u,l,a,c,t[_+2],15,718787259),c=s(c,u,l,a,t[_+9],21,-343485551),a=e(a,d),c=e(c,h),u=e(u,m),l=e(l,f)}return Array(a,c,u,l)}(function(t){for(var e=Array(),r=(1<<u)-1,a=0;a<t.length*u;a+=u)e[a>>5]|=(t.charCodeAt(a/u)&r)<<a%32;return e}(t),t.length*u))}},function(module,exports){function TarWXShare(tarCommon,tarPage){this.tarPage=tarPage;var Ajax=tarCommon.Ajax,tar_slb_domain="",tar_event="",tar_foid="",tar_oid="",tar_nickname="",tar_sex="",tar_province="",tar_city="",tar_country="",tar_headimgurl="",tar_unionid="",tar_uuid="",tar_encrypt="",tar_sharedata="",tar_sign="",tar_timestamp="",timeNow=Date.parse(new Date)/1e3+"",reSetUserinfo=function(t){void 0!==t&&null!=t&&(tar_oid=t.openid,tar_nickname=t.nickname,tar_sex=t.sex,tar_province=t.province,tar_city=t.city,tar_country=t.country,tar_headimgurl=t.headimgurl,tar_unionid=t.unionid,window.localStorage.setItem("tar_userinfo",JSON.stringify(t)),tarCommon.resetOpenid(tar_oid))},that=this,__submitAccess=function(){var t=tarCommon.tar_from,e=tarCommon.tar_url,r=tarCommon.tar_refer,a=tarCommon.tar_width,n=tarCommon.tar_height,o=tarCommon.tar_channel,i=tarCommon.tar_token,s=tarCommon.tar_key,c=(new Date).getTime(),u=tarCommon.hex_md5(i+c+tar_oid);void 0!==tar_foid&&null!=tar_foid&&""!=tar_foid||(tar_foid="root"),void 0!==tar_oid&&null!=tar_oid||(tar_oid=""),void 0!==tar_nickname&&null!=tar_nickname||(tar_nickname=""),void 0!==tar_sex&&null!=tar_sex||(tar_sex=""),void 0!==tar_province&&null!=tar_province||(tar_province=""),void 0!==tar_city&&null!=tar_city||(tar_city=""),void 0!==tar_country&&null!=tar_country||(tar_country=""),void 0!==tar_headimgurl&&null!=tar_headimgurl||(tar_headimgurl=""),void 0!==t&&null!=t||(t=""),void 0!==tar_unionid&&null!=tar_unionid||(tar_unionid=""),void 0!==e&&null!=e||(e=""),void 0!==r&&null!=r||(r=""),void 0!==a&&null!=a||(a=""),void 0!==n&&null!=n||(n=""),void 0!==tar_uuid&&null!=tar_uuid||(tar_uuid=""),void 0!==c&&null!=c||(c=""),void 0!==u&&null!=u||(u="");var l={tar_uuid:tar_uuid,tar_event:tar_event,tar_oid:tar_oid,tar_foid:tar_foid,tar_nickname:tar_nickname,tar_sex:tar_sex,tar_province:tar_province,tar_city:tar_city,tar_country:tar_country,tar_headimgurl:tar_headimgurl,tar_from:t,tar_unionid:tar_unionid,tar_url:e,tar_refer:r,tar_width:a,tar_height:n,tar_nettype:"",tar_channel:o,tar_token:i,tar_epkey:s,tar_time:c,tar_sign:u};that.postdata=l;console.log("发送数据",l),tarCommon.loadSword(),tarCommon.debug("TarWXShare __submit data",l),Ajax.request(tarCommon.posturlnew,{method:"POST",data:l,success:function(t){tarCommon.debug("TarWXShare __submitAccess","wechat access finish"),tarCommon.cb_ready&&tarCommon.cb_ready(tar_oid),tarCommon.tar_init_flag=!0},failure:function(t){console.log("TarWXShare failure",t),tarCommon.debug("TarWXShare failure",t)}})};this.init=function(){if(tar_oid=tarCommon.tar_oid,tar_uuid=tarCommon.tar_uuid,tar_foid=tarCommon.tar_foid,tar_event=tarCommon.tar_event,tar_slb_domain=tarCommon.tar_slb_domain,shorturl=tarCommon.shorturl,!tarCommon.tar_scope)return this.__configUserinfo(tarCommon.tar_userinfo),!0;var t=tarCommon.getUrlArgMap(),e=t.userinfo,r=this.base64Decode(e);tarCommon.debug("TarWXShare init userinfo_64 and url",e+"\n"+window.location.href);var a=window.localStorage.getItem(tarCommon.scopekey);a!=tarCommon.tar_scope&&window.localStorage.setItem(tarCommon.scopekey,tarCommon.tar_scope);var n=Date.parse(new Date)-tarCommon.tar_visit_time_last;if(a&&"snsapi_base"==a&&"snsapi_userinfo"==tarCommon.tar_scope)return tarCommon.debug("TarWXShare init","scope changed"),this.__requestOauth();var o=window.localStorage.getItem(tarCommon.statekey);if(tarCommon.debug("TarWXShare init localState",o),n>=tarCommon.tar_differ_time||!o||"undefined"==o)return tarCommon.debug("TarWXShare init","no local state"),this.__requestOauth();if("1"==o){if(!e)return this.__requestOauth();window.localStorage.setItem(tarCommon.statekey,"2"),window.localStorage.setItem(tarCommon.userinfokey,e)}else if("2"==o){tarCommon.debug("TarWXShare init localState 2 start",o);var i=window.localStorage.getItem(tarCommon.userinfokey);if(""==i||!i||"undefined"==i||null==i)return tarCommon.debug("TarWXShare init __requestOauth start",i),this.__requestOauth();var s=this.base64Decode(i);if(tarCommon.debug("TarWXShare init localUserinfo",s),!s.openid)return tarCommon.debug("TarWXShare init","no local userinfo openid"),this.__requestOauth();if(!e){tarCommon.debug("TarWXShare init","redirect for bringing userinfo");var c=window.location.href,u=window.location.hash;return c=c.substr(0,c.length-u.length),c=/\?/i.test(c)?c+"&userinfo="+i:c+"?userinfo="+i,window.location.href=c+u,window.event&&(window.event.returnValue=!1),!1}if(s.openid!=r.openid)return tarCommon.debug("TarWXShare init","local openid not equal openid of url"),this.__requestOauth()}reSetUserinfo(r),__submitAccess();var l={tar_eventid:tar_event,tar_oid:tar_oid,tar_foid:tar_foid};return this.postEncrypt(l),!0},this.__requestOauth=function(){window.localStorage.setItem(tarCommon.statekey,"1");var oriLocationHref=window.location.href,curLocationHref=tarCommon.removeUrlParam(oriLocationHref,"code");if(curLocationHref=tarCommon.removeUrlParam(curLocationHref,"userinfo"),-1===["snsapi_base","snsapi_userinfo"].indexOf(tarCommon.tar_scope))return"snsapi_none"!=tarCommon.tar_scope||(tarCommon.debug("TarWXShare init no oauth",tarCommon.tar_scope),!0);Ajax.request(tarCommon.tar_open_domain+"/health/check",{method:"POST",data:{},success:function(r){var res=eval("("+r.response+")");if(console.log("-----健康检查-----"),console.log(res),console.log("-----健康检查END-----"),0==res.errcode){var redirect_url=tarCommon.urlencode(curLocationHref),url=tarCommon.oauthurl+"?type=base64&mode=wechat&appid="+tarCommon.tar_appid+"&scope="+tarCommon.tar_scope+"&callback="+redirect_url;return window.location.href=url,window.event&&(window.event.returnValue=!1),!1}},failure:function(){}})},this.__configUserinfo=function(t){if(t&&t[0]&&t[0].openid){var e=t[0];console.log(e),void 0!==e&&null!=e&&(reSetUserinfo(e),window.localStorage.setItem(tarCommon.userinfokey,JSON.stringify(e)))}__submitAccess();var r={tar_eventid:tar_event,tar_oid:tar_oid,tar_foid:tar_foid};this.postEncrypt(r),tarCommon.debug("TarWXShare config","openid: "+tar_oid+"\nfopenid: "+tar_foid)},this.shapeShare=function(data_in,share_kind){var isWechatEnv=/micromessenger/i.test(navigator.userAgent);if(!isWechatEnv)return data_in;tarCommon.debug("TarWXShare shapeShare "+share_kind,data_in);var data=new Object;for(var key in data_in)data_in.hasOwnProperty(key)&&(data[key]=data_in[key]);void 0!==tar_oid&&null!=tar_oid||(tar_oid="");var data_trigger="null";"function"==typeof data.trigger&&(data_trigger=data.trigger);var trigger=function(){if(tarCommon.debug("TarWXShare shapeShare trigger "+share_kind," share start"),"null"!=data_trigger){var trigger_callback_string=data_trigger.toString(),trigger_callback=eval("new "+trigger_callback_string);"function"==typeof trigger_callback&&trigger_callback()}};data.trigger=trigger;var data_success="null";"function"==typeof data.success&&(data_success=data.success);var postdata={tar_event:tar_event,tar_oid:tar_oid,tar_nickname:tar_nickname,tar_kind:share_kind,tar_sign:tar_sign,tar_timestamp:tar_timestamp,tar_status:"null",tar_channel:tarCommon.tar_channel,tar_epkey:tarCommon.tar_key};console.log("postdata",postdata);var __that=this,success=function(){if(postdata.tar_status="success",tarCommon.tar_type){var h=document.body.scrollTop;postdata.tar_position=h}tarCommon.debug("TarWXShare shapeShare success "+share_kind,postdata),Ajax.request(tar_slb_domain+"/in/wxf",{method:"POST",data:postdata,success:function(){if("null"!=data_success){var str="";str="friend"==share_kind?"成功分享到朋友或群":"qq"==share_kind?"成功分享到qq":"qzone"==share_kind?"成功分享到qq空间":"成功分享到朋友圈",__that.tarPage.hitTag(str);var succ_callback_string=data_success.toString(),succ_callback=eval("new "+succ_callback_string);"function"==typeof succ_callback&&succ_callback()}},failure:function(){if("null"!=data_success){var succ_callback_string=data_success.toString(),succ_callback=eval("new "+succ_callback_string);"function"==typeof succ_callback&&succ_callback()}}})};data.success=success;var data_cancel="null";"function"==typeof data.cancel&&(data_cancel=data.cancel);var cancel=function(){postdata.tar_status="cancel",tarCommon.debug("TarWXShare shapeShare cancel "+share_kind,postdata),Ajax.request(tar_slb_domain+"/in/wxf",{method:"POST",data:postdata,success:function(){if("null"!=data_cancel){var str="";str="friend"==share_kind?"取消分享到朋友或群":"qq"==share_kind?"取消分享到qq":"qzone"==share_kind?"取消分享到qq空间":"取消分享到朋友圈",__that.tarPage.hitTag(str);var cancel_callback_string=data_cancel.toString(),cancel_callback=eval("new "+cancel_callback_string);"function"==typeof cancel_callback&&cancel_callback()}},failure:function(){if("null"!=data_cancel){var cancel_callback_string=data_cancel.toString(),cancel_callback=eval("new "+cancel_callback_string);"function"==typeof cancel_callback&&cancel_callback()}}})};return data.cancel=cancel,data.type=1,shapeShareData(data,share_kind)};var shapeShareData=function(t,e){var r=tarCommon.getUrlArgMap(),a=r.tar_shareid;void 0!==a&&null!=a||(a=""),void 0!==tar_foid&&null!=tar_foid&&""!=tar_foid||(tar_foid="root");var n=tar_encrypt,o=tar_sharedata,i=n&&n.length>0?n:tar_oid;o&&(o.share_img&&(t.imgUrl=o.share_img),o.share_desc&&(t.desc=o.share_desc),o.share_title&&(t.title=o.share_title),o.share_link&&(t.link=o.share_link));var s=t.link.trim(),c=!1;return/^https:\/\/open.weixin.qq.com\//.test(s)&&(t.link=decodeURIComponent(tarCommon.getUrlArgMap(s).redirect_uri),c=!0),/\?/i.test(t.link)?/tar_foid/.test(t.link)?t.link=t.link.replace(/tar_foid=[^\?\&\#]*/,"tar_foid="+i):t.link=t.link+"&tar_foid="+i:t.link=t.link+"?tar_foid="+i,c&&(t.link=s.replace(/redirect_uri=[^\?\&\#]*/,"redirect_uri="+encodeURIComponent(t.link))),t.link=tarCommon.removeUrlParam(t.link,"code"),t.link=tarCommon.removeUrlParam(t.link,"userinfo"),"friend"==e?t.link=t.link+"&from=singlemessage":"timeline"==e?t.link=t.link+"&from=timeline":"qq"==e?t.link=t.link+"&from=qq":"qzone"==e&&(t.link=t.link+"&from=qzone"),console.log("share shape data start"),t};this.postEncrypt=function(postdata){tarCommon.debug("TarWXShare postEncrypt start",postdata),Ajax.request(tarCommon.encrypturl,{method:"POST",data:postdata,success:function(r){var ret=eval("("+r.response+")");tarCommon.debug("encrypt success","ok"),tar_encrypt=ret.encrypt,tar_sharedata=ret.sharedata,tar_sign=ret.sign,tar_timestamp=ret.timestamp,tarCommon.tar_channel=ret.tar_channel;var tar_data=that.postdata;tar_data.sharedata=ret.sharedata||{share_title:"",share_img:""},tarCommon.postMessageToMiniprogram(tar_data)},failure:function(t){tarCommon.debug("encrypt failure",t)}})},this.base64Decode=function(t){if(t){var e=tarCommon.str_replace(["-","_"," "],["+","/","="],t);return userinfo_str=tarCommon.utf8to16(tarCommon.base64decode(e)),userinfo=JSON.parse(userinfo_str),userinfo}return new Object},this.shapeShareSuccess=function(t){var e={tar_event:tar_event,tar_oid:tar_oid,tar_nickname:tar_nickname,tar_kind:t,tar_sign:tar_sign,tar_timestamp:tar_timestamp,tar_status:"null",tar_channel:tarCommon.tar_channel,tar_epkey:tarCommon.tar_key};console.log("postdata",e);var r=this;!function(){if(e.tar_status="success",tarCommon.tar_type){var a=document.body.scrollTop;e.tar_position=a}tarCommon.debug("TarWXShare shapeShare success "+t,e),Ajax.request(tar_slb_domain+"/in/wxf",{method:"POST",data:e,success:function(){var e="";e="friend"==t?"成功分享到朋友或群":"qq"==t?"成功分享到qq":"qzone"==t?"成功分享到qq空间":"成功分享到朋友圈",r.tarPage.hitTag(e)},failure:function(){}})}()}}module.exports=TarWXShare},function(t,e){function r(t){var e=t.Ajax,r="",a="",n="",o="1",i="",s="",c=t.tar_channel||"";this.init=function(){r=t.tar_event,a=t.tar_oid,n=t.tar_foid;var e=window.location.href,u=window.location.hash;if(e=e.substr(0,e.length-u.length),e=/\?/i.test(e)?/tar_foid/.test(e)?e.replace(/tar_foid=[^\?\&\#]*/,"tar_foid="+a):e+"&tar_foid="+a:e+"?tar_foid="+a,window.history.pushState){var l=c&&-1===e.indexOf("tar_channel")?"&tar_channel="+c:"";window.history.pushState({},null,e+l+u)}s=document.referrer,i=/urlshare/i.test(s)?"qzone":/QQ/i.test(navigator.userAgent)?"qq":"pc";var _="tar-fuuid-"+r;return n=window.localStorage.getItem(_),o="1",t.debug("TarOTShare init","openid: "+a+"\nfopenid: "+n),this.submitAccess(),!0},this.submitAccess=function(){var c=t.tar_url,u=t.tar_width,l=t.tar_height,_=t.tar_channel||"",d=t.tar_token,h=t.tar_key,m=(new Date).getTime(),f=t.hex_md5(d+m+a);void 0!==n&&null!=n&&""!=n||(n="root"),void 0!==a&&null!=a||(a=""),void 0!==i&&null!=i||(i=""),void 0!==c&&null!=c||(c=""),void 0!==s&&null!=s||(s=""),void 0!==u&&null!=u||(u=""),void 0!==l&&null!=l||(l=""),void 0!==m&&null!=m||(m=""),void 0!==f&&null!=f||(f="");var p={tar_uuid:o,tar_event:r,tar_oid:a,tar_foid:n,tar_nickname:"",tar_sex:"",tar_province:"",tar_city:"",tar_country:"",tar_headimgurl:"",tar_from:i,tar_unionid:"",tar_url:c,tar_refer:s,tar_width:u,tar_height:l,tar_nettype:"",tar_channel:_,tar_token:d,tar_epkey:h,tar_time:m,tar_sign:f};console.log(p),t.debug("TarOTShare submitAccess",p),t.loadSword(),e.request(t.posturlnew,{method:"POST",data:p,success:function(e){console.log("submitAccess over"),t.cb_ready&&t.cb_ready()}})}}t.exports=r},function(module,exports){function TarPage(tarCommon){var Ajax=tarCommon.Ajax,tar_oid="",tar_event="",tar_init_time="",tar_slb_domain="",tar_token="";this.init=function(){tar_event=tarCommon.tar_event,tar_init_time=tarCommon.tar_init_time,tar_slb_domain=tarCommon.tar_slb_domain,this.__setUnloadMo()},this.__setUnloadMo=function(){var t=5e3,e=function(){t*=2,setTimeout(e,t),tar_oid=tarCommon.tar_oid,tar_token=tarCommon.tar_token,tar_stay_time=new Date-tar_init_time,tar_init_time=new Date;var r={tar_event:tar_event,tar_oid:tar_oid,tar_stay:tar_stay_time,tar_token:tar_token,tar_epkey:tarCommon.tar_key};tarCommon.tar_type&&(tarCommon.tar_wxArticle_data.height=document.querySelector("body").offsetHeight,r.tar_article=JSON.stringify(tarCommon.tar_wxArticle_data)),tarCommon.debug("TarPage unload",r),Ajax.request(tarCommon.sendStayurl,{async:!1,method:"POST",data:r})};tarCommon.tar_hot_map||setTimeout(e,t)},this.subscribeClick=function(Id){var element=document.getElementById(Id);if(null==element)return void alert("Fatal Error: wrong ID "+Id+"!");var onclickfun=element.onclick,elementClick=function(){if(onclickfun&&"function"==typeof onclickfun){var onclickfun_string=onclickfun.toString();onclickfun=eval("new "+onclickfun_string),"function"==typeof onclickfun&&onclickfun()}this.hitTag("click",Id)};element.onclick=elementClick},this.subscribeTouchstart=function(Id){var element=document.getElementById(Id);if(null==element)return void alert("Fatal Error: wrong ID "+Id+"!");var ontouchstartfun=element.ontouchstart,elementTouchstart=function(){if(ontouchstartfun&&"function"==typeof ontouchstartfun){var ontouchstartfun_string=ontouchstartfun.toString();ontouchstartfun=eval("new "+ontouchstartfun_string),"function"==typeof ontouchstartfun&&ontouchstartfun()}this.hitTag("touchstart",Id)};element.ontouchstart=elementTouchstart},this.subscribeTouchmove=function(Id){var element=document.getElementById(Id);if(null==element)return void alert("Fatal Error: wrong ID "+Id+"!");var ontouchmovefun=element.ontouchmove,elementTouchmove=function(){if(ontouchmovefun&&"function"==typeof ontouchmovefun){var ontouchmovefun_string=ontouchmovefun.toString();ontouchmovefun=eval("new "+ontouchmovefun_string),"function"==typeof ontouchmovefun&&ontouchmovefun()}this.hitTag("touchmove",Id)};element.ontouchmove=elementTouchmove},this.subscribeTouchend=function(Id){var element=document.getElementById(Id);if(null==element)return void alert("Fatal Error: wrong ID "+Id+"!");var ontouchendfun=element.ontouchend,elementTouchend=function(){if(ontouchendfun&&"function"==typeof ontouchendfun){var ontouchendfun_string=ontouchendfun.toString();ontouchendfun=eval("new "+ontouchendfun_string),"function"==typeof ontouchendfun&&ontouchendfun()}this.hitTag("touchend",Id)};element.ontouchend=elementTouchend},this.hitTag=function(t,e){tar_oid=tarCommon.tar_oid,tarCommon.debug("TarPage hitTag",tar_event+"\n"+tar_oid+"\n"+t+"\n"+e),Ajax.request(tarCommon.hitTagurl,{method:"POST",data:{tar_event:tar_event,tar_oid:tar_oid,tar_key:t,tar_value:e,tar_channel:tarCommon.tar_channel,tar_token:tarCommon.tar_token,tar_epkey:tarCommon.tar_key}})}}module.exports=TarPage}]);