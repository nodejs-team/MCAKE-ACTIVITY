<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="../commoncss/wap-normalize.css">
    <link rel="stylesheet" href="styles/index.css">
</head>
<body>
<div class="choujiang">
    <div class="chouqian">
        <div class="qian qian-1"></div>
        <div class="qian qian-2"></div>
        <div class="qian qian-3"></div>
        <div class="qian qian-4"></div>
        <div class="qian qian-5"></div>
        <div class="qian qian-6"></div>
        <div class="qian qian-7"></div>
        <div class="qian-tong"></div>
    </div>
    <div class="qian-btn" onclick="sendMessage()"><img src="images/yao-btn.png" alt=""></div>
    <div class="shou"><img src="images/yaoyao.png" class="shoudong" alt=""></div>
</div>
<script src="https://act.mcake.com/fangli/2019/wap/commonjs/jquery.min.js"></script>
<script src="https://act.mcake.com/fangli/2019/wap/commonjs/flexible.js"></script>
<script src="https://act.mcake.com/fangli/2019/wap/commonjs/fastclick.js"></script>
<script src="https://act.mcake.com/fangli/2019/wap/commonjs/vconsole.min.js"></script>

<script>

    var vConsole = new VConsole();

        window.addEventListener('message', function (event) {
            /*if(window.parent !== event.source){ return false; }*/
            Scheduler.translate(event)
        }, false);

        var Scheduler = {
            // 消息事件对象
            event: {},
            // 参数
            params: {},
            // 翻译
            translate: function (data) {
                this.event = event;
                this.params = typeof(event.data) == 'string' ? JSON.parse(event.data) : event.data;
                this.execute();
            },
            // 执行
            execute: function () {
                switch (this.params.method) {
                    // 抽奖
                    case 'choujiang':
                        //console.log(this.params.data.id);
                        start(this.params.data);
                        break;

                    // 默认
                    default:
                }
            }
        }

        var sendMessage=function() {
            top.postMessage({method: 'choujiang',data:{id:7}}, "*");
        }


        function start(data) {


            var arr = [{"data-pond":"1磅,2磅,3磅,5磅",
                "data-weight":"454g,908g,1.36kg,2.27kg",
                "data-price":"218,318,458,750",
                "data-time":"提示：提前5小时预定,提示：提前5小时预定,提示：提前5小时预定,提示：提前5小时预定",
                "data-postid":"01,02,03,04",
                "data-tips":"尺寸：2-3人食 16cm*10cm*8cm,尺寸：4-7人食 23cm*14cm*8cm,尺寸：8-12人食 28cm*18cm*8cm,尺寸：12-20人食 36cm*22cm*8cm",
                "data-sku":"n0201,n0202,n0203,n0205",
                "data-method":"1,1,1,1",
                "data-pid":"1810,1810,1810,1810",
                "data-ptype":"2,2,2,2",
                "data-channel":"976,976,976,976"},
                {"data-pond":"2磅",
                    "data-weight":"908g",
                    "data-price":"298",
                    "data-time":"提示：提前5小时预定",
                    "data-postid":"01",
                    "data-tips":"尺寸：4-7人食 15cm*9cm(直径*高度)",
                    "data-sku":"R0329",
                    "data-method":"1",
                    "data-pid":"1810",
                    "data-ptype":"2",
                    "data-channel":"976"},
                {"data-pond":"1磅,2磅,3磅,5磅",
                    "data-weight":"454g,908g,1.36kg,2.27kg",
                    "data-price":"198,298,428,728",
                    "data-time":"提示：提前5小时预定,提示：提前5小时预定,提示：提前5小时预定,提示：提前5小时预定",
                    "data-postid":"01,02,03,04",
                    "data-tips":"尺寸：2-3人食 16cm*10cm*4.5cm,尺寸：4-7人食 23cm*14cm*5cm,尺寸：8-12人食 28cm*18cm*5cm,尺寸：12-20人食 36cm*22cm*6cm",
                    "data-sku":"N0501,N0502,N0503,N0505",
                    "data-method":"1,1,1,1",
                    "data-pid":"1810,1810,1810,1810",
                    "data-ptype":"2,2,2,2",
                    "data-channel":"976,976,976,976"},
                {"data-pond":"1磅,2磅,3磅,5磅",
                    "data-weight":"454g,908g,1.36kg,2.27kg",
                    "data-price":"198,298,428,728",
                    "data-time":"提示：提前5小时预定,提示：提前5小时预定,提示：提前5小时预定,提示：提前5小时预定",
                    "data-postid":"01,02,03,04",
                    "data-tips":"尺寸：2-3人食 16cm*7cm,尺寸：4-7人食 21cm*7cm,尺寸：8-12人食 26cm*7cm,尺寸：12-20人食 32cm*7cm",
                    "data-sku":"c0301,c0302,c0303,c0305",
                    "data-method":"1,1,1,1",
                    "data-pid":"1810,1810,1810,1810",
                    "data-ptype":"2,2,2,2",
                    "data-channel":"976,976,976,976"},
                {"data-pond":"1.5磅,2.5磅",
                    "data-weight":"681g,1.14kg",
                    "data-price":"298,398",
                    "data-time":"提示：提前5小时预定,提示：提前5小时预定",
                    "data-postid":"01,02",
                    "data-tips":"尺寸：2-3人食 15cm*8.2cm,尺寸：4-7人食 16.5cm*9.5cm(直径*高)",
                    "data-sku":"R0102,R0103",
                    "data-method":"1,1",
                    "data-pid":"1810,1810",
                    "data-ptype":"2,2",
                    "data-channel":"976,976"},
                {"data-pond":"1磅,2磅,3磅,5磅",
                    "data-weight":"454g,908g,1.36kg,2.27kg",
                    "data-price":"198,298,428,728",
                    "data-time":"提示：提前5小时预定,提示：提前5小时预定,提示：提前5小时预定,提示：提前5小时预定",
                    "data-postid":"01,02,03,04",
                    "data-tips":"尺寸：2-3人食 16cm*10cm*5cm,尺寸：4-7人食 23cm*14cm*5cm,尺寸：8-12人食 28cm*18cm*5cm,尺寸：12-20人食 36cm*22cm*5.5cm",
                    "data-sku":"n0301,n0302,n0303,n0305",
                    "data-method":"1,1,1,1",
                    "data-pid":"1810,1810,1810,1810",
                    "data-ptype":"2,2,2,2",
                    "data-channel":"976,976,976,976"},
                {"data-pond":"1磅",
                    "data-weight":"454g",
                    "data-price":"198",
                    "data-time":"提示：提前5小时预定",
                    "data-postid":"01",
                    "data-tips":"尺寸：2-3人食 13cm*6cm(直径*高)",
                    "data-sku":"R0391",
                    "data-method":"1",
                    "data-pid":"1810",
                    "data-ptype":"2",
                    "data-channel":"976"}
            ];
            var prize = {'好运签':1,'美貌签':2,'发财签':3,'升职签':4,'桃花签':5,'健康签':6,'瘦身签':7};
            var random = parseInt(prize[data['title']]); /*中奖id*/
            /*console.log(data);
            console.log(random);*/

            $(".qian-tong").addClass("yaodong");
            $(".qian").each(function (i) {
                $(this).addClass("yaoyao"+(i+1));
            });

            setTimeout(function () {
                $(".qian-tong").delay(1000).removeClass("yaodong");
                $(".qian").each(function (i) {
                    $(this).delay(1000).removeClass("yaoyao"+(i+1))
                });
            },2500)

            setTimeout(function () {
                //choujiang(data);
               // QuanDialog(random); /*摇摇结束后，弹出优惠券*/
                /*显示抽奖结果,向首页提交弹窗结果*/
                var autoMessage = {method:'choujiangResult',message:'抽奖结果展示',data:{DialogCover:".Dialogbg-quan",DialogBox:".Dialog-quan",n:random,arr:arr,prize:prize}};
                top.postMessage(autoMessage,'*');
            },2000)
        }




        /*需要放在服务器环境下，否则iphone不执行*/
        /*运动事件监听*/
        if (window.DeviceMotionEvent) {
            window.addEventListener('devicemotion',deviceMotionHandler,false);
        }

        /*获取加速度信息
         通过监听上一步获取到的x, y, z 值在一定时间范围内的变化率，进行设备是否有进行晃动的判断。
         而为了防止正常移动的误判，需要给该变化率设置一个合适的临界值。
         */
        var SHAKE_THRESHOLD = 8000;  /*临界值4000*/
        var last_update = 0;
        var x, y, z, last_x = 0, last_y = 0, last_z = 0;
        console.log(window.DeviceMotionEvent);
        function deviceMotionHandler(eventData) {
            var acceleration =eventData.accelerationIncludingGravity;
            var curTime = new Date().getTime();
            if ((curTime-last_update)> 10) {
                var diffTime = curTime -last_update;
                last_update = curTime;
                x = acceleration.x;
                y = acceleration.y;
                z = acceleration.z;
                var speed = Math.abs(x +y + z - last_x - last_y - last_z) / diffTime * 10000;
                console.log(speed);
                if (speed > SHAKE_THRESHOLD) {
                    alert("你中奖啦111！");
                    sendMessage();
                }
                last_x = x;
                last_y = y;
                last_z = z;
            }
        }




</script>
</body>
</html>